<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Live Planetarium with Events</title>
	<style>
		body {
			font-family: 'Trebuchet MS', Tahoma, Helvetica, Verdana, sans-serif;
			color: black;
			margin: 0px;
			padding: 0px;
		}
		#starmap {
			width: 100%;
			height: 90vh; /* Full screen height */
			position: relative;
		}
	</style>
	<script src="stuquery.min.js"></script>
	<script src="virtualsky.min.js" type="text/javascript"></script>
</head>
<body>

	<!-- The container for the live planetarium -->
	<div id="starmap"></div>

	<script>
		// Initialize the planetarium
		let planetarium;

		// List of all astronomical events in 2025 with custom Sky-Map.org images and SIMBAD URLs
		const astronomicalEvents = [
			{ 
				date: "2025-01-03", 
				name: "Quadrantid Meteor Shower", 
				ra: 15.0, 
				dec: 49.5, 
				identifier: "Quadrantids", 
				colour: "rgb(150, 150, 255)" 
			},
			{ 
				date: "2025-01-07", 
				name: "CAROL Meteor Shower", 
				ra: 10.5, 
				dec: 24.0, 
				identifier: "Eta_Aquariids", 
				colour: "rgb(100, 150, 255)" 
			},			
			{ 
				date: "2025-01-10", 
				name: "Partial Solar Eclipse", 
				ra: 18.5, 
				dec: -23.0, 
				identifier: "Solar_Eclipse", 
				colour: "rgb(255, 150, 150)" 
			},
			{ 
				date: "2025-01-28", 
				name: "Total Lunar Eclipse", 
				ra: 8.5, 
				dec: 21.0, 
				identifier: "Lunar_Eclipse", 
				colour: "rgb(255, 100, 100)" 
			},
			{ 
				date: "2025-04-22", 
				name: "Lyrid Meteor Shower", 
				ra: 18.3, 
				dec: 34.0, 
				identifier: "Lyrids", 
				colour: "rgb(100, 255, 100)" 
			},
			{ 
				date: "2025-05-07", 
				name: "Eta Aquarid Meteor Shower", 
				ra: 22.5, 
				dec: -1.5, 
				identifier: "Eta_Aquariids", 
				colour: "rgb(100, 150, 255)" 
			},
			{ 
				date: "2025-08-13", 
				name: "Perseid Meteor Shower", 
				ra: 3.4, 
				dec: 58.0, 
				identifier: "Perseids", 
				colour: "rgb(100, 100, 255)" 
			},
			{ 
				date: "2025-10-17", 
				name: "Partial Solar Eclipse", 
				ra: 13.5, 
				dec: -8.0, 
				identifier: "Solar_Eclipse", 
				colour: "rgb(255, 150, 150)" 
			},
			{ 
				date: "2025-11-18", 
				name: "Leonid Meteor Shower", 
				ra: 10.2, 
				dec: 22.0, 
				identifier: "Leonids", 
				colour: "rgb(255, 255, 100)" 
			},
			{ 
				date: "2025-12-14", 
				name: "Geminid Meteor Shower", 
				ra: 7.6, 
				dec: 32.0, 
				identifier: "Geminids", 
				colour: "rgb(255, 200, 100)" 
			}
		];

		// Function to generate a custom Sky-Map.org image link based on RA and Dec
		function generateSkyMapImage(ra, dec) {
			const baseUrl = "http://server7.sky-map.org/imgcut";
			return `${baseUrl}?survey=DSS2&w=128&h=128&ra=${ra}&de=${dec}&angle=1.25&output=PNG`;
		}

		// Function to generate a SIMBAD URL based on an identifier
		function generateSIMBADUrl(identifier) {
			const baseUrl = "http://simbad.u-strasbg.fr/simbad/sim-id";
			return `${baseUrl}?Ident=${identifier}`;
		}

		// Function to add labeled events to the planetarium
		function addAstronomicalEventLabels() {
			const currentDate = new Date();
			const threeDaysLater = new Date();
			threeDaysLater.setDate(currentDate.getDate() + 3); // Add 3 days to current date

			astronomicalEvents.forEach(event => {
				const eventDate = new Date(event.date);

				// Only show the event if it is today or in the next 3 days
				if (eventDate.toDateString() === currentDate.toDateString()) {
					planetarium.addPointer({
						ra: event.ra, // Right Ascension
						dec: event.dec, // Declination
						label: event.name, // Event label
						img: generateSkyMapImage(event.ra, event.dec), // Custom Sky-Map.org image
						url: generateSIMBADUrl(event.identifier), // SIMBAD URL
						credit: "SIMBAD", // Credit for the URL
						colour: event.colour // Label color
					});
				}
				// Only show the event if it is in the next 3 days
				if (eventDate >= currentDate && eventDate <= threeDaysLater) {
					planetarium.addPointer({
						ra: event.ra, // Right Ascension
						dec: event.dec, // Declination
						label: event.name, // Event label
						img: generateSkyMapImage(event.ra, event.dec), // Custom Sky-Map.org image
						url: generateSIMBADUrl(event.identifier), // SIMBAD URL
						credit: "SIMBAD", // Credit for the URL
						colour: event.colour // Label color
					});
				}				
			});
		}

		// Wait for the DOM to load
		S(document).ready(function() {
			// Check if geolocation is supported
			if (navigator.geolocation) {
				// Get the user's current position
				navigator.geolocation.getCurrentPosition(
					(position) => {
						// Use the latitude and longitude to set up the planetarium
						planetarium = S.virtualsky({
							id: 'starmap', // The ID of the container
							latitude: position.coords.latitude, // User's latitude
							longitude: position.coords.longitude, // User's longitude
							projection: 'stereo', // Stereographic projection
							live: false, // Enable live updates
							clock: new Date(), // Current date and time
							showposition: true, // Show position marker
							showconstellations: true, // Show constellations
							showgridlines: false, // Hide gridlines
							showgalaxy: true, // Show Milky Way
							showplanets: true, // Show planets
							showstarlabels: true, // Show star labels
							showorbits: false, // Hide orbits
						});

						// Add labeled events to the planetarium
						addAstronomicalEventLabels();
					},
					(error) => {
						console.error('Geolocation error:', error.message);
						alert('Unable to retrieve location. Please enable location services.');
					}
				);
			} else {
				alert('Geolocation is not supported by your browser.');
			}
		});
	</script>

</body>
</html>
